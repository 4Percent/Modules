!function(t){function e(t){return 10>t?"0"+t:""+t}function n(t){t=t||{},this.input=t.input,this.parent=t.parent,this.handler=t.handler,this.format=t.format||["年","月","日"],this.autoHide=t.autoHide||!1,this.shiftLeft=t.shiftLeft||100,this.filter=t.filter||function(){return!1},this.init()}function a(){var t=document.getElementsByTagName("head")[0],e=document.createElement("link"),n=t.getElementsByTagName("script")[0];e.rel="stylesheet",e.href="css/simple_calendar.css",n?t.insertBefore(e,n):t.appendChild(e)}var i=t.addEventListener?function(t,e,n){t.addEventListener(e,n,!1)}:function(e,n,a){e.attachEvent("on"+n,function(){var n,i=t.event;return i.preventDefault=function(){n=!1},i.target=i.srcElement,a.call(e,i),!1})},l=!1;l||a(),t.SimpleCalendar=n,n.prototype={constructor:n,init:function(){this.createCal(),this.monthOffset=0,this.fillCal(),this.addHandler(),this.activateBtns(),this.input&&this.respondToClick()},createCal:function(){this.cal=document.createElement("div"),this.cal.className="m-simple-cal",this.input||(this.cal.className+=" m-cal-static"),this.cal.innerHTML='<div class="m-cal-head"><div class="m-cal-month">2015年10月</div><a href="javascript:;" class="m-cal-prev"></a><a href="javascript:;" class="m-cal-next"></a></div><ol class="m-cal-week"><li>周一</li><li>周二</li><li>周三</li><li>周四</li><li>周五</li><li class="m-cal-weekend">周六</li><li class="m-cal-weekend">周日</li></ol><ol class="m-cal-days"></ol>',this.month=this.cal.querySelector(".m-cal-month"),this.btnPrev=this.cal.querySelector(".m-cal-prev"),this.btnNext=this.cal.querySelector(".m-cal-next"),this.dayList=this.cal.querySelector(".m-cal-days"),this.listLen=42,this.input?(this.input.parentNode.appendChild(this.cal),this.cal.style.top=this.input.offsetHeight+this.input.offsetTop+"px"):this.parent.appendChild(this.cal)},fillCal:function(){this.dayList.innerHTML="";var t=new Date;t.setMonth(t.getMonth()+this.monthOffset);var n,a,i=t.getFullYear(),l=t.getMonth()+1,s=t.getDate(),c=new Date(i,l,0),o=c.getDate(),r=(c.getDay(),new Date(i,l-1,1).getDay()||7),h=r-1,m=new Date(i,l-1,0).getDate()-h+1,f=this.listLen-h-o,u=(o+h)%7+1,d=document.createDocumentFragment();this.month.innerHTML=t.getFullYear()+"年"+e(l)+"月";for(var p=0;h>p;p++)n=document.createElement("li"),n.className="m-cal-lastM",5===p&&(n.className+=" m-cal-weekend"),n.innerHTML=m+p,d.appendChild(n);for(p=0;o>p;p++)n=document.createElement("li"),a=(r+p)%7,(0===a||6===a)&&(n.className="m-cal-weekend"),this.monthOffset||p!==s-1?n.innerHTML=p+1:(n.className+=" m-cal-today",n.innerHTML="今天"),this.filter(i,l,p+1)&&(n.className+=" m-cal-sp"),d.appendChild(n);for(p=0;f>p;p++)n=document.createElement("li"),a=(u+p)%7,n.className="m-cal-nextM",(0===a||6===a)&&(n.className+=" m-cal-weekend"),n.innerHTML=p+1,d.appendChild(n);this.dayList.appendChild(d)},addHandler:function(){var t=this;i(this.dayList,"mousedown",function(t){t.preventDefault()}),i(this.dayList,"click",function(n){var a,i=n.target,l=new Date,s=l.getMonth()+t.monthOffset;"LI"===i.tagName&&(-1!==i.className.indexOf("m-cal-lastM")?s--:-1!==i.className.indexOf("m-cal-nextM")&&s++,l.setMonth(s),a="今天"===i.innerHTML?l.getDate():i.innerHTML,t.input&&(t.input.value=l.getFullYear()+t.format[0]+e(l.getMonth()+1)+t.format[1]+e(a)+t.format[2],t.autoHide&&(t.cal.style.display="none")),t.handler&&t.handler.call(i,l.getFullYear(),l.getMonth()+1,+a))})},activateBtns:function(){function t(t){var a=250;n.monthOffset+=t,n.fillCal(),e=setTimeout(function i(){n.monthOffset+=t,n.fillCal(),a=a-50||50,e=setTimeout(i,a)},a)}var e,n=this;this.btnPrev.onmousedown=function(){t(-1)},this.btnNext.onmousedown=function(){t(1)},this.btnPrev.onmouseup=this.btnNext.onmouseup=function(){clearTimeout(e)}},respondToClick:function(){var t=this;i(this.input,"click",function(e){t.cal.style.display="block",t.cal.style.left=e.offsetX+t.input.offsetLeft-t.shiftLeft+"px"}),i(document,"click",function(e){var n=e.target;t.cal.contains(n)||n===t.input||(t.cal.style.display="none")})}}}(window);