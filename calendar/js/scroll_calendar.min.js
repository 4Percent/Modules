!function(t){function e(){var t=document.getElementsByTagName("head")[0],e=document.createElement("link"),i=t.getElementsByTagName("script")[0];e.rel="stylesheet",e.href="css/scroll_calendar.css",i?t.insertBefore(e,i):t.appendChild(e),o=!0}function i(t){return 10>t?"0"+t:""+t}function n(t){t=t||{},this.input=t.input,this.format=t.format||["年","月","日"],this.parent=t.parent,this.handler=t.handler,this.shiftLeft=t.shiftLeft||146,this.init()}var s=t.addEventListener?function(t,e,i){t.addEventListener(e,i,!1)}:function(e,i,n){e.attachEvent("on"+i,function(){var i=t.event;i.target=i.srcElement,n.call(e,i)})},l=/firefox/i.test(t.navigator.userAgent)?function(t,e){t.addEventListener("DOMMouseScroll",function(i){e.call(t,i.detail>0)},!1)}:function(e,i){e.addEventListener?e.addEventListener("mousewheel",function(t){i.call(e,t.wheelDelta<0),t.preventDefault()},!1):e.attachEvent("onmousewheel",function(){return i.call(e,t.event.wheelDelta<0),!1},!1)},a=t.getComputedStyle?function(e,i){return t.getComputedStyle(e,"")[i]}:function(t,e){return t.currentStyle[e]},r=t.requestAnimationFrame?function(e){return t.requestAnimationFrame(e)}:function(t){return setTimeout(t,18)},c=t.cancelRequestFrame?function(e){t.cancelRequestFrame(e)}:function(t){clearTimeout(t)},o=!1;o||e(),t.ScrollCalendar=n,n.prototype={constructor:n,init:function(){this.createCal(),this.enableScroll(),this.addHandler()},createCal:function(){this.cal=document.createElement("div"),this.cal.className="m-scroll-cal",this.cal.innerHTML='<div class="m-sc-head">选择日期</div><div class="m-sc-body"><ul class="m-sc-col m-sc-year"><li></li><li></li><li></li><li></li><li></li></ul><ul class="m-sc-col m-sc-month"><li></li><li></li><li></li><li></li><li></li></ul><ul class="m-sc-col m-sc-date"><li></li><li></li><li></li><li></li><li></li></ul></div><a href="javascript:;" class="m-sc-confirm">确 定</a>';var t,e=this.cal.getElementsByTagName("ul");this.btn=this.cal.querySelector(".m-sc-confirm"),this.lists={year:e[0],month:e[1],day:e[2]},this.curDate=new Date,this.input?this.input.parentNode.appendChild(this.cal):(this.cal.className+=" m-sc-static",this.parent.appendChild(this.cal)),this.years=this.lists.year.children,this.months=this.lists.month.children,this.days=this.lists.day.children,this.liHeight=parseFloat(a(this.lists.year.children[0],"height")),this.opFactor=1/this.liHeight/2,this.opMid=this.liHeight;for(var i=0;i<this.years.length;i++)t=(i-1)*this.liHeight,this.years[i].style.top=this.months[i].style.top=this.days[i].style.top=t+"px",this.years[i].style.opacity=this.months[i].style.opacity=this.days[i].style.opacity=1-Math.abs(t-this.opMid)*this.opFactor;this.updateCal()},updateCal:function(){for(var t=this.curDate.getFullYear()-2,e=this.curDate.getMonth()-2,i=this.curDate.getDate()-2,n=new Date(t),s=new Date(t),l=0;l<this.years.length;l++)this.years[l].innerHTML=t+l,n.setMonth(e+l),s.setMonth(e+2,i+l),this.months[l].innerHTML=n.getMonth()+1,this.days[l].innerHTML=s.getDate()},relocateLi:function(t,e){t.style.top=e+"px",t.style.opacity=1-Math.abs(e-this.opMid)*this.opFactor},listScroll:function(t,e,i,n,s){var l,a,c=this;if(this[e]>0){for(var o=0;4>=o;o++)l=t.children[o],1===o&&(a=l.offsetTop+this[e]),this.relocateLi(l,l.offsetTop+this[e]);a>=25&&(t.insertBefore(t.children[4],t.children[0]),t.children[0].style.top=a-100+"px",s(-1)),this[e]*=.95}else{for(var o=4;o>=0;o--)l=t.children[o],3===o&&(a=l.offsetTop+this[e]),this.relocateLi(l,l.offsetTop+this[e]);75>=a&&(t.appendChild(t.children[0]),t.children[4].style.top=a+100+"px",s(1)),this[e]*=.95}Math.abs(this[e])>.5?r(function(){c[n]()}):(this[i]=!1,this.endScroll(t))},endScroll:function(t){var e=20,i=0,n=t.children[0].offsetTop,s=-this.liHeight-n,l=this;this.timerEnd=r(function a(){var c;i++,c=n+(1-Math.pow(1-i/e,3))*s,Math.round(c)!==-l.liHeight?l.timerEnd=r(a):c=-l.liHeight;for(var o=0;o<t.children.length;o++)l.relocateLi(t.children[o],c+o*l.liHeight)})},yearScroll:function(){var t=this;this.listScroll(this.lists.year,"yearSpeed","yearMoving","yearScroll",function(e){t.curDate.setYear(t.curDate.getFullYear()+e),t.updateCal()})},monthScroll:function(){var t=this;this.listScroll(this.lists.month,"monthSpeed","monthMoving","monthScroll",function(e){t.curDate.setMonth(t.curDate.getMonth()+e),t.updateCal()})},dayScroll:function(){var t=this;this.listScroll(this.lists.day,"daySpeed","dayMoving","dayScroll",function(e){t.curDate.setDate(t.curDate.getDate()+e),t.updateCal()})},enableScroll:function(){var t=this;this.speedIncre=4;for(var e in this.lists)!function(){var i=e,n=t.lists[i],s=i+"Speed";l(n,function(e){t[i+"Moving"]?t[s]>0&&e?(t[s]+=t.speedIncre,t[s]>20&&(t[s]=20)):t[s]<0&&!e?(t[s]+=-t.speedIncre,t[s]<-20&&(t[s]=-20)):t[s]=e?t.speedIncre:-t.speedIncre:(c(t.timerEnd),t[s]=e?t.speedIncre:-t.speedIncre,t[i+"Scroll"](),t[i+"Moving"]=!0)})}()},addHandler:function(){var t=this;this.handler&&s(this.btn,"click",function(){t.handler(t.curDate.getFullYear(),t.curDate.getMonth()+1,t.curDate.getDate())}),this.input&&(s(this.btn,"click",function(e){t.input.value=t.curDate.getFullYear()+t.format[0]+i(t.curDate.getMonth()+1)+t.format[1]+i(t.curDate.getDate())+t.format[2],t.cal.style.display="none"}),s(this.input,"click",function(e){t.cal.style.display="block",t.cal.style.left=e.offsetX+t.input.offsetLeft-t.shiftLeft+"px"}),s(document,"click",function(e){var i=e.target;t.cal.contains(i)||i===t.input||(t.cal.style.display="none")}))}}}(window);