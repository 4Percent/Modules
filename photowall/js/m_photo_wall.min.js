!function(t){function e(t){for(var e=0,i=0;t.offsetParent;)e+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent;return{left:e,top:i}}function i(t){this.con=t.container,this.cards=t.container.children,this.mode=t.mode||"normal",this.modeEnd=this.mode+"End",this.activeClass=t.activeClass,this.actRegExp=new RegExp("\\b"+this.activeClass+"\\b"),this.duration=t.duration||400,this.totalFrames=~~(this.duration/16),this.convertLayout(),this.initWall()}var s=t.addEventListener?function(t,e,i){t.addEventListener(e,i,!1)}:function(t,e,i){t.attachEvent("on"+e,i)},o=t.removeEventListener?function(t,e,i){t.removeEventListener(e,i,!1)}:function(t,e,i){t.detachEvent("on"+e,i)},n=t.requestAnimationFrame?function(e){return t.requestAnimationFrame(e)}:function(e){return t.setTimeout(e,20)},a=t.cancelAnimationFrame?function(e){t.cancelAnimationFrame(e)}:function(e){t.clearTimeout(e)};i.prototype={constructor:i,convertLayout:function(){var t;e(this.con);this.pos=[];for(var i=this.cards.length-1;i>=0;i--)t=this.cards[i],this.pos[i]={left:t.offsetLeft,top:t.offsetTop},t.style.left=this.pos[i].left+"px",t.style.top=this.pos[i].top+"px",t.style.margin=0,t.style.position="absolute",t.posIdx=i;this.cardWidth=t.offsetWidth,this.cardHeight=t.offsetHeight,this.tagName=t.tagName},initWall:function(){var e=this;this.prevCollided=null,s(this.con,"mousedown",function(i){function n(i){return i=i||t.event,e.minIdx=null,e.minDis=null,e.target.style.left=i.clientX-d+"px",e.target.style.top=i.clientY-l+"px",e[e.mode](),!1}function h(){e[e.modeEnd](),e.target.style.zIndex=0,o(document,"mousemove",n),o(document,"mouseup",h)}i=i||t.event;var r=i.target||i.srcElement;if(r.tagName===e.tagName){e.target=r,e.target.style.zIndex=10,a(e.target.timer),e.minIdx=null,e.minDis=null;var d=i.clientX-e.target.offsetLeft,l=i.clientY-e.target.offsetTop;e[e.mode](),s(document,"mousemove",n),s(document,"mouseup",h)}return i.preventDefault&&i.preventDefault(),!1})},calcDis:function(t,e){var i,s=this.target.offsetLeft,o=this.target.offsetTop;s>t.left+this.cardWidth||s+this.cardWidth<t.left||o>t.top+this.cardHeight||o+this.cardHeight<t.top||(i=Math.pow(s-t.left,2)+Math.pow(o-t.top,2),(null===this.minDis||i<this.minDis)&&(this.minDis=i,this.minIdx=e))},move:function(t,e){var i={left:t.offsetLeft,top:t.offsetTop},s={left:e.left-i.left,top:e.top-i.top},o=0,h=this.totalFrames;a(t.timer),t.timer=n(function r(){t.style.left=++o/h*s.left+i.left+"px",t.style.top=o/h*s.top+i.top+"px",h>o&&(t.timer=n(r))})},switchCard:function(t,e){var i=t.posIdx;t.posIdx=e.posIdx,e.posIdx=i,this.move(t,this.pos[t.posIdx]),this.move(e,this.pos[e.posIdx])},deactivate:function(){this.cards[this.prevCollided].className=this.cards[this.prevCollided].className.replace(this.actRegExp,"").replace(/\s+/," ").replace(/^\s|\s$/g,""),this.prevCollided=null},normal:function(){for(var t,e=0;e<this.cards.length;e++)t=this.cards[e],t!==this.target&&this.calcDis(this.pos[t.posIdx],e);this.prevCollided!==this.minIdx&&(null!==this.prevCollided&&this.deactivate(),null!==this.minIdx&&(this.prevCollided=this.minIdx,this.cards[this.minIdx].className+=this.activeClass))},normalEnd:function(){null!==this.minIdx?(this.switchCard(this.target,this.cards[this.minIdx]),this.deactivate()):this.move(this.target,this.pos[this.target.posIdx])},phone:function(){for(var t=0;t<this.pos.length;t++)this.calcDis(this.pos[t],t);if(null!==this.minIdx&&this.minIdx!==this.target.posIdx){var e,i=Math.min(this.minIdx,this.target.posIdx),s=Math.max(this.minIdx,this.target.posIdx),o=i===this.minIdx?1:-1;for(t=0;t<this.cards.length;t++)e=this.cards[t],e===this.target?this.target.posIdx=this.minIdx:e.posIdx>=i&&e.posIdx<=s&&(e.posIdx+=o,this.move(e,this.pos[e.posIdx]))}},phoneEnd:function(){this.move(this.target,this.pos[this.target.posIdx])},setMode:function(t){this.mode=t,this.modeEnd=this.mode+"End"},shuffle:function(){var t=[];t.push.apply(t,this.cards),t.sort(function(){return Math.random()-.5});for(var e=0;e<t.length;e++)t[e].posIdx=e,this.move(t[e],this.pos[e])}},t.PhotoWall=i}(window);